{
  "version": 3,
  "sources": ["../../../../src/lib/miner/miner/Miner.ts"],
  "sourcesContent": ["import type { MinerSettings } from '../model/MinerSettings';\nimport * as crypto from 'node:crypto';\nimport type { MinerFeatureKey } from '../model/MinerFeature';\nimport { Logger } from '../model/Logger';\nimport type { MinerStats } from '../model/MinerStats';\n\n/**\n *\n */\nexport abstract class Miner<S extends MinerSettings> {\n    protected logger: Logger;\n    private statSubscriptions: ((stats: MinerStats) => Promise<void>)[] = [];\n\n    /**\n     *\n     */\n    constructor(public readonly settings: S) {\n        if (!settings.id) {\n            this.settings.id = crypto.randomUUID();\n        }\n        this.logger = Logger.getLogger(this.getLoggerName());\n    }\n\n    /**\n     * Get the features supported by this miner\n     */\n    public abstract getSupportedFeatures(): MinerFeatureKey[];\n\n    /**\n     * Initialize the miner: connect, start polling (for polling miners, ...), ...\n     */\n    public abstract init(): Promise<void>;\n\n    /**\n     * Start mining\n     */\n    public abstract start(): Promise<void>;\n\n    /**\n     * Stop mining\n     */\n    public abstract stop(): Promise<void>;\n\n    /**\n     * Close / cleanup any open resources\n     */\n    public close(): Promise<void> {\n        this.statSubscriptions = [];\n        return Promise.resolve();\n    }\n\n    /**\n     * Get name to use for the logger\n     */\n    protected getLoggerName(): string {\n        return `Miner[${this.settings.id}, ${this.settings.minerType}]`;\n    }\n\n    /**\n     * Subscribe to miner stats\n     *\n     * @param callback - callback that gets called when new stats are available\n     */\n    public subscribeToStats(callback: (stats: MinerStats) => Promise<void>): void {\n        this.statSubscriptions.push(callback);\n    }\n\n    /**\n     * Called by the miner when new stats are available.\n     * Subscribers will be notified.\n     *\n     * @param stats - the new stats\n     */\n    public async onStats(stats: MinerStats): Promise<void> {\n        this.logger.debug(`publishing new stats to subscribers: ${JSON.stringify(stats)}`);\n        for (const sub of this.statSubscriptions) {\n            await sub(stats);\n        }\n    }\n\n    /**\n     * Get the command line arguments required to append to the miner start command for this adapter to be able to connect to the miner / communicate with it\n     */\n    public abstract getCliArgs(): string[];\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,aAAwB;AAExB,oBAAuB;AAMhB,MAAe,MAA+B;AAAA;AAAA;AAAA;AAAA,EAOjD,YAA4B,UAAa;AAAb;AACxB,QAAI,CAAC,SAAS,IAAI;AACd,WAAK,SAAS,KAAK,OAAO,WAAW;AAAA,IACzC;AACA,SAAK,SAAS,qBAAO,UAAU,KAAK,cAAc,CAAC;AAAA,EACvD;AAAA,EAXU;AAAA,EACF,oBAA8D,CAAC;AAAA;AAAA;AAAA;AAAA,EAmChE,QAAuB;AAC1B,SAAK,oBAAoB,CAAC;AAC1B,WAAO,QAAQ,QAAQ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKU,gBAAwB;AAC9B,WAAO,SAAS,KAAK,SAAS,EAAE,KAAK,KAAK,SAAS,SAAS;AAAA,EAChE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOO,iBAAiB,UAAsD;AAC1E,SAAK,kBAAkB,KAAK,QAAQ;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAa,QAAQ,OAAkC;AACnD,SAAK,OAAO,MAAM,wCAAwC,KAAK,UAAU,KAAK,CAAC,EAAE;AACjF,eAAW,OAAO,KAAK,mBAAmB;AACtC,YAAM,IAAI,KAAK;AAAA,IACnB;AAAA,EACJ;AAMJ;",
  "names": []
}
