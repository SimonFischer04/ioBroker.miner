{
  "version": 3,
  "sources": ["../../../../src/lib/miner/miner/PollingMiner.ts"],
  "sourcesContent": ["import { Miner } from './Miner';\nimport type { PollingMinerSettings } from '../model/MinerSettings';\nimport type { AsyncIntervalReturnType } from '../../utils/delay';\nimport { asyncInterval } from '../../utils/delay';\nimport type { MinerStats } from '../model/MinerStats';\n\nexport abstract class PollingMiner<S extends PollingMinerSettings> extends Miner<S> {\n    private pollInterval: AsyncIntervalReturnType | undefined;\n\n    public abstract fetchStats(): Promise<MinerStats>;\n\n    public override init(): Promise<void> {\n        this.logger.info(`initializing with interval ${this.settings.pollInterval}`);\n\n        if (!this.settings.pollInterval || this.settings.pollInterval < 100) {\n            this.logger.error(`pollInterval >= 100 required. got: ${this.settings.pollInterval}`);\n            return Promise.resolve();\n        }\n\n        // start polling\n        this.pollInterval = asyncInterval(\n            async () => {\n                this.logger.debug('next poll interval time reached. calling fetchData()');\n                try {\n                    const stats: MinerStats = await this.fetchStats();\n                    await this.onStats(stats);\n                } catch (e) {\n                    this.logger.error(`fetchStats failed: ${String(e)}`);\n                }\n            },\n            this.settings.pollInterval,\n            true,\n        );\n        return Promise.resolve();\n    }\n\n    public override async close(): Promise<void> {\n        await super.close();\n        this.pollInterval?.clear();\n    }\n\n    public override getLoggerName(): string {\n        return `${super.getLoggerName()}PollingMiner[${this.settings.pollInterval}]`;\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAsB;AAGtB,mBAA8B;AAGvB,MAAe,qBAAqD,mBAAS;AAAA,EACxE;AAAA,EAIQ,OAAsB;AAClC,SAAK,OAAO,KAAK,8BAA8B,KAAK,SAAS,YAAY,EAAE;AAE3E,QAAI,CAAC,KAAK,SAAS,gBAAgB,KAAK,SAAS,eAAe,KAAK;AACjE,WAAK,OAAO,MAAM,sCAAsC,KAAK,SAAS,YAAY,EAAE;AACpF,aAAO,QAAQ,QAAQ;AAAA,IAC3B;AAGA,SAAK,mBAAe;AAAA,MAChB,YAAY;AACR,aAAK,OAAO,MAAM,sDAAsD;AACxE,YAAI;AACA,gBAAM,QAAoB,MAAM,KAAK,WAAW;AAChD,gBAAM,KAAK,QAAQ,KAAK;AAAA,QAC5B,SAAS,GAAG;AACR,eAAK,OAAO,MAAM,sBAAsB,OAAO,CAAC,CAAC,EAAE;AAAA,QACvD;AAAA,MACJ;AAAA,MACA,KAAK,SAAS;AAAA,MACd;AAAA,IACJ;AACA,WAAO,QAAQ,QAAQ;AAAA,EAC3B;AAAA,EAEA,MAAsB,QAAuB;AApCjD;AAqCQ,UAAM,MAAM,MAAM;AAClB,eAAK,iBAAL,mBAAmB;AAAA,EACvB;AAAA,EAEgB,gBAAwB;AACpC,WAAO,GAAG,MAAM,cAAc,CAAC,gBAAgB,KAAK,SAAS,YAAY;AAAA,EAC7E;AACJ;",
  "names": []
}
