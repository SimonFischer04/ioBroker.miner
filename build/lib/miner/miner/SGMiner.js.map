{
  "version": 3,
  "sources": ["../../../../src/lib/miner/miner/SGMiner.ts"],
  "sourcesContent": ["import type { SGMinerSettings } from '../model/MinerSettings';\nimport { PollingMiner } from './PollingMiner';\nimport type { MinerStats } from '../model/MinerStats';\nimport { MinerFeatureKey } from '../model/MinerFeature';\nimport { sendSocketCommand } from '../../utils/socket-utils';\n\n// https://github.com/ckolivas/cgminer/blob/master/API-README\nenum SGMinerCommand {\n    stats = 'summary+coin',\n}\n\n/**\n *\n */\nexport class SGMiner extends PollingMiner<SGMinerSettings> {\n    /**\n     *\n     */\n    public override async init(): Promise<void> {\n        await super.init();\n        // sgminer/cgminer api does not support persistent connections (socket is closed after each command), so don't need to init any connection here\n        return Promise.resolve();\n    }\n\n    /**\n     *\n     */\n    public override start(): Promise<void> {\n        this.logger.error('start() not (yet) implemented');\n        return Promise.resolve();\n    }\n\n    /**\n     *\n     */\n    public override async fetchStats(): Promise<MinerStats> {\n        try {\n            const response = await this.sendCommand<object>(SGMinerCommand.stats, '', true);\n            // TODO: parse response => actually return stats\n\n            return {\n                raw: response,\n            };\n        } catch (e) {\n            // forward error\n            return Promise.reject(e);\n        }\n    }\n\n    /**\n     *\n     */\n    public override stop(): Promise<void> {\n        this.logger.error('stop() not (yet) implemented');\n        return Promise.resolve();\n    }\n\n    /**\n     *\n     */\n    public override getSupportedFeatures(): MinerFeatureKey[] {\n        return [MinerFeatureKey.rawStats];\n    }\n\n    /**\n     *\n     */\n    public override getLoggerName(): string {\n        return `${super.getLoggerName()}SGMiner[${this.settings.host}:${this.settings.port}]`;\n    }\n\n    /**\n     *\n     */\n    public override getCliArgs(): string[] {\n        return [`--api_listen=0.0.0.0:${this.settings.port}`];\n    }\n\n    private async sendCommand<T = void>(\n        command: SGMinerCommand,\n        parameter: string = '',\n        expectResponse: boolean = true,\n    ): Promise<T> {\n        return sendSocketCommand(\n            this.logger,\n            this.settings.host,\n            this.settings.port,\n            {\n                command,\n                parameter,\n            },\n            expectResponse,\n        );\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,0BAA6B;AAE7B,0BAAgC;AAChC,0BAAkC;AAGlC,IAAK,iBAAL,kBAAKA,oBAAL;AACI,EAAAA,gBAAA,WAAQ;AADP,SAAAA;AAAA,GAAA;AAOE,MAAM,gBAAgB,iCAA8B;AAAA;AAAA;AAAA;AAAA,EAIvD,MAAsB,OAAsB;AACxC,UAAM,MAAM,KAAK;AAEjB,WAAO,QAAQ,QAAQ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKgB,QAAuB;AACnC,SAAK,OAAO,MAAM,+BAA+B;AACjD,WAAO,QAAQ,QAAQ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAsB,aAAkC;AACpD,QAAI;AACA,YAAM,WAAW,MAAM,KAAK,YAAoB,4BAAsB,IAAI,IAAI;AAG9E,aAAO;AAAA,QACH,KAAK;AAAA,MACT;AAAA,IACJ,SAAS,GAAG;AAER,aAAO,QAAQ,OAAO,CAAC;AAAA,IAC3B;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKgB,OAAsB;AAClC,SAAK,OAAO,MAAM,8BAA8B;AAChD,WAAO,QAAQ,QAAQ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKgB,uBAA0C;AACtD,WAAO,CAAC,oCAAgB,QAAQ;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKgB,gBAAwB;AACpC,WAAO,GAAG,MAAM,cAAc,CAAC,WAAW,KAAK,SAAS,IAAI,IAAI,KAAK,SAAS,IAAI;AAAA,EACtF;AAAA;AAAA;AAAA;AAAA,EAKgB,aAAuB;AACnC,WAAO,CAAC,wBAAwB,KAAK,SAAS,IAAI,EAAE;AAAA,EACxD;AAAA,EAEA,MAAc,YACV,SACA,YAAoB,IACpB,iBAA0B,MAChB;AACV,eAAO;AAAA,MACH,KAAK;AAAA,MACL,KAAK,SAAS;AAAA,MACd,KAAK,SAAS;AAAA,MACd;AAAA,QACI;AAAA,QACA;AAAA,MACJ;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AACJ;",
  "names": ["SGMinerCommand"]
}
